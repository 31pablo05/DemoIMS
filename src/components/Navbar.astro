---
const currentPath = Astro.url.pathname;

const navItems = [
  { name: 'Inicio',         href: '/',              icon: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6' },
  { name: 'Servicios',      href: '/servicios',     icon: 'M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z' },
  { name: 'Profesionales',  href: '/profesionales', icon: 'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z' },
  { name: 'Turnos',         href: '/turnos',        icon: 'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' },
  { name: 'Horarios',       href: '/horarios',      icon: 'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z' },
];
---

<!-- Top accent bar -->
<div class="nav-accent-bar h-1 w-full sticky top-0 z-50"></div>

<nav class="navbar-glass sticky top-1 z-50">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">

      <!-- Logo & Brand -->
      <a href="/" class="flex items-center gap-3 group focus:outline-none">
        <img
          src="/imagenes/logo/logo2.svg"
          alt="Instituto Médico del Sur"
          class="navbar-logo"
        />
        <div class="flex flex-col leading-none">
          <span class="brand-title text-sm sm:text-base font-extrabold tracking-tight">
            Instituto Médico del Sur
          </span>
          <span class="brand-sub text-[10px] sm:text-xs font-medium tracking-widest uppercase hidden sm:block mt-0.5">
            Trelew · Chubut
          </span>
        </div>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-1">
        {navItems.map((item) => (
          <a
            href={item.href}
            class:list={[
              'nav-link group relative flex items-center gap-2 px-4 py-2 rounded-xl font-semibold text-sm transition-all duration-300',
              currentPath === item.href ? 'nav-link--active' : ''
            ]}
          >
            <svg class="w-3.5 h-3.5 flex-shrink-0 transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={item.icon} />
            </svg>
            <span>{item.name}</span>
            {currentPath === item.href && (
              <span class="active-dot"></span>
            )}
          </a>
        ))}

        <!-- Divider -->
        <div class="w-px h-6 bg-gray-200 mx-2"></div>

        <!-- Turno CTA -->
        <a
          href="/turnos"
          class="cta-turno flex items-center gap-2 px-4 py-2 rounded-xl font-semibold text-sm transition-all duration-300"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          <span>Pedir Turno</span>
        </a>

        <!-- Call CTA -->
        <a
          href="tel:2804421121"
          class="cta-call flex items-center gap-2 px-5 py-2 rounded-xl font-bold text-sm transition-all duration-300 group"
        >
          <svg class="w-4 h-4 group-hover:rotate-12 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
          </svg>
          <span class="hidden xl:inline">280 4421121</span>
          <span class="xl:hidden">Llamar</span>
        </a>
      </div>

      <!-- Mobile: call chip + hamburger -->
      <div class="lg:hidden flex items-center gap-2">
        <a
          href="tel:2804421121"
          class="cta-call-mobile flex items-center gap-1.5 px-3 py-2 rounded-xl font-semibold text-xs transition-all duration-300"
        >
          <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
          </svg>
          <span class="hidden sm:inline">Llamar</span>
        </a>

        <button
          id="mobile-menu-button"
          class="hamburger-btn relative w-10 h-10 rounded-xl transition-all duration-300 flex items-center justify-center"
          aria-label="Abrir menú"
          aria-expanded="false"
        >
          <div class="relative w-5 h-3.5 flex flex-col justify-between">
            <span class="menu-bar menu-line-1"></span>
            <span class="menu-bar menu-line-2"></span>
            <span class="menu-bar menu-line-3"></span>
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Drawer -->
  <div
    id="mobile-menu"
    class="mobile-drawer lg:hidden"
    aria-hidden="true"
  >
    <div class="mobile-drawer-inner mx-4 mb-4 rounded-2xl overflow-hidden">
      <div class="p-2 space-y-1">
        {navItems.map((item) => (
          <a
            href={item.href}
            class:list={[
              'mobile-nav-item flex items-center gap-3 px-4 py-3.5 rounded-xl font-semibold text-sm transition-all duration-300',
              currentPath === item.href ? 'mobile-nav-item--active' : ''
            ]}
          >
            <span class:list={[
              'mobile-nav-icon flex items-center justify-center w-8 h-8 rounded-lg transition-all duration-300',
              currentPath === item.href ? 'mobile-nav-icon--active' : ''
            ]}>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={item.icon} />
              </svg>
            </span>
            <span class="flex-1">{item.name}</span>
            {currentPath === item.href && (
              <span class="mobile-active-badge text-xs font-bold px-2 py-0.5 rounded-full">Aquí</span>
            )}
          </a>
        ))}
      </div>

      <!-- Mobile CTAs -->
      <div class="mobile-cta-section p-3 grid grid-cols-2 gap-2">
        <a
          href="/turnos"
          class="cta-turno-mobile flex flex-col items-center justify-center gap-1.5 py-4 rounded-xl font-bold text-sm transition-all duration-300"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          <span>Pedir Turno</span>
        </a>
        <a
          href="tel:2804421121"
          class="cta-call-bottom flex flex-col items-center justify-center gap-1.5 py-4 rounded-xl font-bold text-sm transition-all duration-300"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
          </svg>
          <span>280 4421121</span>
        </a>
      </div>
    </div>
  </div>
</nav>

<script>
  const button = document.getElementById('mobile-menu-button');
  const menu   = document.getElementById('mobile-menu');
  let isOpen = false;

  function openMenu() {
    isOpen = true;
    menu?.classList.add('mobile-drawer--open');
    button?.classList.add('menu-open');
    button?.setAttribute('aria-expanded', 'true');
    menu?.setAttribute('aria-hidden', 'false');
  }

  function closeMenu() {
    isOpen = false;
    menu?.classList.remove('mobile-drawer--open');
    button?.classList.remove('menu-open');
    button?.setAttribute('aria-expanded', 'false');
    menu?.setAttribute('aria-hidden', 'true');
  }

  button?.addEventListener('click', () => { isOpen ? closeMenu() : openMenu(); });

  document.addEventListener('click', (e) => {
    if (isOpen && !button?.contains(e.target as Node) && !menu?.contains(e.target as Node)) closeMenu();
  });

  document.addEventListener('astro:after-swap', closeMenu);
</script>

<style>
  /* ─── Accent bar ─────────────────────────────────────────── */
  .nav-accent-bar {
    background: linear-gradient(90deg, #003554, #0074B7 40%, #00A8E1 70%, #0074B7);
    background-size: 200% 100%;
    animation: shimmer-bar 6s linear infinite;
  }
  @keyframes shimmer-bar {
    0%   { background-position: 0% 0%; }
    100% { background-position: 200% 0%; }
  }

  /* ─── Navbar glass ──────────────────────────────────────── */
  .navbar-glass {
    background: rgba(255, 255, 255, 0.97);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(0, 116, 183, 0.10);
    box-shadow: 0 4px 24px -4px rgba(0, 116, 183, 0.10), 0 1px 0 rgba(0, 116, 183, 0.06);
    transition: box-shadow 0.3s ease;
  }

  /* ─── Logo ───────────────────────────────────────────────── */
  .navbar-logo {
    width: 48px;
    height: 48px;
    object-fit: contain;
    flex-shrink: 0;
    animation: logo-entrance 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) both;
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1),
                filter 0.3s ease;
    filter: drop-shadow(0 2px 8px rgba(0, 116, 183, 0.20));
  }
  a:hover .navbar-logo {
    transform: scale(1.12) rotate(-4deg);
    filter: drop-shadow(0 4px 14px rgba(0, 116, 183, 0.40));
  }
  @keyframes logo-entrance {
    from {
      opacity: 0;
      transform: scale(0.6) rotate(-15deg);
      filter: drop-shadow(0 0 0 rgba(0,116,183,0));
    }
    to {
      opacity: 1;
      transform: scale(1) rotate(0deg);
      filter: drop-shadow(0 2px 8px rgba(0, 116, 183, 0.20));
    }
  }

  /* ─── Brand text ─────────────────────────────────────────── */
  .brand-title {
    background: linear-gradient(135deg, #003554 0%, #0074B7 50%, #00A8E1 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1.2;
  }
  .brand-sub {
    color: #94a3b8;
    letter-spacing: 0.12em;
  }

  /* ─── Desktop nav links ──────────────────────────────────── */
  .nav-link {
    color: #475569;
    position: relative;
  }
  .nav-link:hover {
    color: #0074B7;
    background: linear-gradient(135deg, rgba(0,116,183,0.07), rgba(0,168,225,0.07));
  }
  .nav-link--active {
    color: #0074B7 !important;
    background: linear-gradient(135deg, rgba(0,116,183,0.10), rgba(0,168,225,0.10)) !important;
    font-weight: 700;
  }
  .active-dot {
    position: absolute;
    bottom: 5px;
    left: 50%;
    transform: translateX(-50%);
    width: 18px;
    height: 3px;
    border-radius: 99px;
    background: linear-gradient(90deg, #0074B7, #00A8E1);
  }

  /* ─── CTA: Pedir Turno ───────────────────────────────────── */
  .cta-turno {
    color: #0074B7;
    background: rgba(0,116,183,0.08);
    border: 1.5px solid rgba(0,116,183,0.20);
  }
  .cta-turno:hover {
    background: rgba(0,116,183,0.14);
    border-color: rgba(0,116,183,0.35);
    transform: translateY(-1px);
    box-shadow: 0 4px 14px rgba(0,116,183,0.18);
  }

  /* ─── CTA: Llamar ────────────────────────────────────────── */
  .cta-call {
    color: #fff;
    background: linear-gradient(135deg, #0074B7, #00A8E1);
    box-shadow: 0 4px 14px rgba(0,116,183,0.30);
  }
  .cta-call:hover {
    background: linear-gradient(135deg, #005A8C, #0074B7);
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(0,116,183,0.40);
  }
  .cta-call:active {
    transform: translateY(0);
  }

  /* ─── Mobile call chip ───────────────────────────────────── */
  .cta-call-mobile {
    color: #0074B7;
    background: rgba(0,116,183,0.08);
    border: 1.5px solid rgba(0,116,183,0.18);
  }
  .cta-call-mobile:hover {
    background: rgba(0,116,183,0.14);
  }

  /* ─── Hamburger button ───────────────────────────────────── */
  .hamburger-btn {
    background: rgba(0,116,183,0.06);
    border: 1.5px solid rgba(0,116,183,0.14);
  }
  .hamburger-btn:hover {
    background: rgba(0,116,183,0.12);
    border-color: rgba(0,116,183,0.28);
  }
  .menu-bar {
    display: block;
    width: 100%;
    height: 2px;
    background: #0074B7;
    border-radius: 99px;
    transition: transform 0.35s cubic-bezier(0.68,-0.55,0.27,1.55), opacity 0.2s ease;
    transform-origin: center;
  }
  .menu-open .menu-line-1 { transform: translateY(6px) rotate(45deg); }
  .menu-open .menu-line-2 { opacity: 0; transform: scaleX(0); }
  .menu-open .menu-line-3 { transform: translateY(-6px) rotate(-45deg); }

  /* ─── Mobile Drawer ──────────────────────────────────────── */
  .mobile-drawer {
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    transition: max-height 0.38s cubic-bezier(0.4,0,0.2,1), opacity 0.28s ease;
  }
  .mobile-drawer--open {
    max-height: 600px;
    opacity: 1;
  }
  .mobile-drawer-inner {
    background: #fff;
    border: 1px solid rgba(0,116,183,0.10);
    box-shadow: 0 20px 50px -10px rgba(0,116,183,0.18), 0 4px 16px -4px rgba(0,0,0,0.06);
  }

  /* ─── Mobile nav items ───────────────────────────────────── */
  .mobile-nav-item {
    color: #475569;
  }
  .mobile-nav-item:hover {
    color: #0074B7;
    background: rgba(0,116,183,0.05);
    transform: translateX(3px);
  }
  .mobile-nav-item--active {
    color: #0074B7 !important;
    background: linear-gradient(135deg, rgba(0,116,183,0.08), rgba(0,168,225,0.08)) !important;
    font-weight: 700;
  }
  .mobile-nav-icon {
    background: rgba(0,116,183,0.07);
    color: #64748b;
  }
  .mobile-nav-item:hover .mobile-nav-icon {
    background: rgba(0,116,183,0.12);
    color: #0074B7;
  }
  .mobile-nav-icon--active {
    background: linear-gradient(135deg, #0074B7, #00A8E1) !important;
    color: #fff !important;
  }
  .mobile-active-badge {
    background: linear-gradient(135deg, rgba(0,116,183,0.12), rgba(0,168,225,0.12));
    color: #0074B7;
  }

  /* ─── Mobile CTA section ─────────────────────────────────── */
  .mobile-cta-section {
    border-top: 1px solid rgba(0,116,183,0.08);
    background: rgba(0,116,183,0.025);
  }
  .cta-turno-mobile {
    color: #0074B7;
    background: rgba(0,116,183,0.08);
    border: 1.5px solid rgba(0,116,183,0.18);
  }
  .cta-turno-mobile:hover {
    background: rgba(0,116,183,0.14);
    transform: translateY(-1px);
  }
  .cta-call-bottom {
    color: #fff;
    background: linear-gradient(135deg, #0074B7, #00A8E1);
    box-shadow: 0 4px 14px rgba(0,116,183,0.25);
  }
  .cta-call-bottom:hover {
    background: linear-gradient(135deg, #005A8C, #0074B7);
    transform: translateY(-1px);
    box-shadow: 0 6px 18px rgba(0,116,183,0.35);
  }

  /* ─── Scrolled shadow boost via JS class ────────────────── */
  .navbar-glass.scrolled {
    box-shadow: 0 8px 32px -4px rgba(0, 116, 183, 0.18), 0 2px 0 rgba(0, 116, 183, 0.06);
  }
</style>

<script>
  /* Scrolled shadow */
  const nav = document.querySelector('.navbar-glass') as HTMLElement | null;
  window.addEventListener('scroll', () => {
    nav?.classList.toggle('scrolled', window.scrollY > 10);
  }, { passive: true });
</script>
